<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Noah TFT Chatbot</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/chatbot.css') }}">
</head>
<body>
  <div class="chat-container">
    <div id="chatbox"></div>

    <div class="input-area">
      <input id="userInput" placeholder="ê¶ê¸ˆí•œ ì ì„ ì…ë ¥í•˜ì„¸ìš”!" />
      <button onclick="sendMsg()">ë³´ë‚´ê¸°</button>
    </div>
  </div>

  <script>
    // âœ… ì¸ì‚¿ë§ í•¨ìˆ˜
    function showWelcomeMessage() {
      const chatbox = document.getElementById("chatbox");
      const botRow = document.createElement("div");
      botRow.className = "chat-row bot fade-in";
      botRow.innerHTML = `
        <img src="{{ url_for('static', filename='images/bot5.jpg') }}" class="bot-icon" alt="ë´‡">
        <div class='bubble bot-bubble'>ì•ˆë…•í•˜ì„¸ìš” ğŸ‘‹<br>ë¡¤í† ì²´ìŠ¤ ì±—ë´‡ì…ë‹ˆë‹¤.<br>ì±”í”¼ì–¸ ì´ë¦„ì´ë‚˜ ë± ê´€ë ¨ ì§ˆë¬¸ì„ ì…ë ¥í•´ë³´ì„¸ìš”!</div>
      `;
      chatbox.appendChild(botRow);
    }

    // ğŸ§  ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
    async function sendMsg() {
      const input = document.getElementById("userInput");
      const chatbox = document.getElementById("chatbox");
      const msg = input.value.trim();
      if (!msg) return;

      // ğŸ™‹ ìœ ì € ë©”ì‹œì§€
      const userMsg = document.createElement("div");
      userMsg.className = "chat-row user fade-in";
      userMsg.innerHTML = `<div class='bubble user-bubble'>${msg}</div>`;
      chatbox.appendChild(userMsg);
      input.value = "";

      chatbox.scrollTop = chatbox.scrollHeight;

      // ğŸ’¬ ì„œë²„ ì „ì†¡
      const res = await fetch("/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: msg })
      });

      const data = await res.json();

      // ğŸ¤– ë´‡ ë©”ì‹œì§€
      const botRow = document.createElement("div");
      botRow.className = "chat-row bot fade-in";
      botRow.innerHTML = `
        <img src="{{ url_for('static', filename='images/bot5.jpg') }}" class="bot-icon" alt="ë´‡">
        <div class='bubble bot-bubble'>${data.reply}</div>
      `;
      chatbox.appendChild(botRow);

      chatbox.scrollTop = chatbox.scrollHeight;
    }

    // âœ… ì—”í„°í‚¤ë¡œ ì „ì†¡ + ì¸ì‚¿ë§ ìë™ í‘œì‹œ
    document.addEventListener("DOMContentLoaded", () => {
      showWelcomeMessage(); // ğŸ‘ˆ ì²« ì…ì¥ ì¸ì‚¿ë§ ì‹¤í–‰

      const input = document.getElementById("userInput");
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          sendMsg();
        }
      });
    });
  </script>
</body>
</html>
