<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>TFT ì‹œë„ˆì§€ ì˜ˆì¸¡ ì‹œë®¬ë ˆì´í„°</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/synergy_analyze.css') }}">
</head>
<body>
  <!-- ğŸ”™ ì±—ë´‡ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ -->
  <a href="{{ url_for('chatbot') }}" class="back-to-chatbot">
    ğŸ’¬ ì±—ë´‡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
  </a>

  <h1>ğŸ”® TFT ì‹œë„ˆì§€ ì˜ˆì¸¡ ì‹œë®¬ë ˆì´í„°</h1>

  <div class="grid">
    <aside class="left">
      <h2>ğŸ“œ ì±”í”¼ì–¸ ëª©ë¡</h2>
      <div id="champion-pool">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </aside>

    <main class="middle">
      <div class="boards">
        <div class="team-board" id="enemyTeam">
          <h2>ìƒëŒ€ íŒ€</h2>
          <div class="board" id="board-enemy"></div>
        </div>
        <div class="team-board" id="myTeam">
          <h2>ë‚´ íŒ€</h2>
          <div class="board" id="board-my"></div>
        </div>
      </div>

      <div class="bottom">
        <div class="result-bar">
          <div class="myTeamBar"></div>
          <div class="enemyTeamBar"></div>
          <div class="bar-labels">
            <span>ğŸ’™ ë‚´ íŒ€</span>
            <span>â¤ï¸ ìƒëŒ€ íŒ€</span>
          </div>
        </div>
        <div id="winnerText" class="winner-text"></div>
        <button id="analyze">ìŠ¹ë¥  ì˜ˆì¸¡í•˜ê¸°</button>
        <div class="control-buttons">
          <button id="resetMyTeam">ë‚´ íŒ€ ì´ˆê¸°í™”</button>
          <button id="resetEnemyTeam">ìƒëŒ€ íŒ€ ì´ˆê¸°í™”</button>
        </div>
        <div id="resultText" class="result-text">íŒ€ì„ ë°°ì¹˜í•˜ë©´ ì‹œë„ˆì§€ê°€ ì˜¤ë¥¸ìª½ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
      </div>
    </main>

    <aside class="right">
      <h2>ğŸ”¥ ìƒëŒ€ ì‹œë„ˆì§€</h2>
      <div class="synergy-card"><div id="enemySynergy" class="synergy-list"></div></div>
      <h2>ğŸ’§ ë‚´ ì‹œë„ˆì§€</h2>
      <div class="synergy-card"><div id="mySynergy" class="synergy-list"></div></div>
    </aside>
  </div>

  <!-- âœ… ë¦¬ ì‹  íƒœì„¸ ì„ íƒ ëª¨ë‹¬ (ì¶”ê°€) -->
  <div class="stance-modal-backdrop" id="stanceBackdrop" aria-hidden="true">
    <div class="stance-modal" role="dialog" aria-modal="true" aria-labelledby="stanceTitle">
      <h3 id="stanceTitle">ë¦¬ ì‹  íƒœì„¸ ì„ íƒ</h3>
      <div id="stanceTeamText" style="font-size:13px; opacity:.9; margin-bottom:6px;"></div>
      <div class="stance-options">
        <button class="stance-btn" data-stance="ì²˜í˜•ì">ì²˜í˜•ì</button>
        <button class="stance-btn" data-stance="ì „ìŸê¸°ê³„">ì „ìŸê¸°ê³„</button>
        <button class="stance-btn" data-stance="ê²°íˆ¬ê°€">ê²°íˆ¬ê°€</button>
      </div>
      <button class="stance-cancel" id="stanceCancel">ë‹«ê¸°</button>
      <div class="stance-note">â€» íƒœì„¸ì˜ ëŒ€ê°€ëŠ” í•­ìƒ ìœ ì§€ë©ë‹ˆë‹¤. ì„ íƒí•œ íƒœì„¸ëŠ” ë¦¬ ì‹ ì´ ì „ì¥ì— ìˆì„ ë•Œë§Œ ì¶”ê°€ ì‹œë„ˆì§€ë¡œ ì ìš©ë©ë‹ˆë‹¤.</div>
    </div>
  </div>
</body>
</html>

<script>
let CHAMPIONS=[],TRAIT_NAME_KO={};
// ì‹œë„ˆì§€ ì„¤ëª… (íˆ´íŒì— ì‚¬ìš©)
const TRAIT_DESCRIPTIONS = {
  "ê±°ëŒ€ ë©”í¬" : "ê±°ëŒ€ ë©”í¬ ë¡œë´‡ì„ íšë“í•©ë‹ˆë‹¤. ê±°ëŒ€ ë©”í¬ê°€ ì…íŒ í”¼í•´ëŸ‰ì˜ 12%ë§Œí¼ ì²´ë ¥ì„ íšŒë³µí•©ë‹ˆë‹¤. ê° ê±°ëŒ€ ë©”í¬ ì±”í”¼ì–¸ì˜ ë³„ ë ˆë²¨ë‹¹ ê±°ëŒ€ ë©”í¬ ë¡œë´‡ì˜ ìœ„ë ¥ì´ ì¦ê°€í•©ë‹ˆë‹¤.",
  "ê´´ë¬¼ íŠ¸ë ˆì´ë„ˆ" : "ë£°ë£¨ê°€ ì†Œí™˜í•´ ì „íˆ¬ì— ëŒ€ì‹  ë‚´ë³´ë‚¼ ê´´ë¬¼ì„ ì„ íƒí•˜ì„¸ìš”!",
  "ë ˆìŠ¬ë§ ì±”í”¼ì–¸" : "ë ˆìŠ¬ë§ ì±”í”¼ì–¸ì´ í”Œë ˆì´ì–´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ìŠ¹ë¦¬í•˜ë©´ ë ˆìŠ¬ë§ ì±”í”¼ì–¸ì˜ ë³„ ë ˆë²¨ë§Œí¼ í¬ë¡œ íŒ¬ì´ ì¶”ê°€ë©ë‹ˆë‹¤. íŒ¨ë°° ì‹œ í¬ë¡œ íŒ¬ í•˜ë‚˜ë‹¹ ì „ëµê°€ í”¼í•´ëŸ‰ì´ 1 ê°ì†Œí•©ë‹ˆë‹¤. ì´í›„ í¬ë¡œ íŒ¬ì„ ëª¨ë‘ ìƒìŠµë‹ˆë‹¤.",
  "ë©˜í† " : "ì´ íŠ¹ì„±ì€ ë©˜í† ê°€ ì •í™•íˆ í•˜ë‚˜ ë˜ëŠ” ê°ê¸° ë‹¤ë¥¸ ë©˜í† ê°€ ë„· ìˆì„ ë•Œ í™œì„±í™”ë©ë‹ˆë‹¤.",
  "ë³„ ìˆ˜í˜¸ì" : "ë³„ ìˆ˜í˜¸ìëŠ” ëª¨ë“  ë³„ ìˆ˜í˜¸ìì—ê²Œ ë¶€ì—¬ë˜ëŠ” ê³ ìœ  íŒ€ì›Œí¬ ì¶”ê°€ íš¨ê³¼ë¥¼ ê°–ìŠµë‹ˆë‹¤. ë°°ì¹˜ëœ ë³„ ìˆ˜í˜¸ìë§ˆë‹¤ ì¶”ê°€ íš¨ê³¼ë¥¼ ê°•í™”í•©ë‹ˆë‹¤!",
  "ì†Œìš¸ íŒŒì´í„°" : "ì†Œìš¸ íŒŒì´í„°ê°€ ì¶”ê°€ ì²´ë ¥ì„ ì–»ê³  ë§¤ì´ˆ ê³µê²©ë ¥ê³¼ ì£¼ë¬¸ë ¥ì„ ì–»ìŠµë‹ˆë‹¤. ìµœëŒ€ 8íšŒê¹Œì§€ ì¤‘ì²©ë©ë‹ˆë‹¤. ìµœëŒ€ ì¤‘ì²© ì‹œ ì¶”ê°€ ê³ ì • í”¼í•´ë¥¼ ì…í™ë‹ˆë‹¤.",
  "ìˆ˜ì • ê°¬ë¹—" : "í”Œë ˆì´ì–´ ëŒ€ìƒ ì „íˆ¬ì—ì„œ ì²˜ì¹˜ ë° íŒ¨ë°° ì‹œ ë³´ì„ì˜ í˜ì„ ì–»ìŠµë‹ˆë‹¤. í”Œë ˆì´ì–´ ëŒ€ìƒ ì „íˆ¬ 3íšŒë§ˆë‹¤ ë³´ì„ì˜ í˜ì„ ë³´ìƒìœ¼ë¡œ ì „í™˜í•˜ê±°ë‚˜ 'ë¬»ê³  ë‘ ë°°ë¡œ ê°€'ë¥¼ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 'ë¬»ê³  ë‘ ë°°ë¡œ ê°€'ë¥¼ í™œì„±í™”í•˜ë©´ íŒ¨ë°° ì‹œ ë³´ì„ì˜ í˜ì„ 100% ë” ì–»ì§€ë§Œ, ìŠ¹ë¦¬ ì‹œ ë³´ì„ì˜ í˜ 50%ë¥¼ ìƒê³  ì¦‰ì‹œ ì´ìµì„ ì‹¤í˜„í•©ë‹ˆë‹¤.",
  "ìŠˆí”„ë¦¼ ì…€" : "ì§€ë‚œ ì „íˆ¬ì—ì„œ ê°€ì¥ ë§ì€ í”¼í•´ë¥¼ ì…íŒ ì…€ì´ ìŠˆí”„ë¦¼ì´ ë©ë‹ˆë‹¤. ìŠˆí”„ë¦¼ ì…€ì´ ì‚¬ë§í•˜ë©´, í˜„ì¬ ê°€ì¥ ë§ì€ í”¼í•´ë¥¼ ì…íŒ ì…€ì´ ìŠˆí”„ë¦¼ì´ ë©ë‹ˆë‹¤. ì…€ì´ í”¼í•´ ì¦í­ì„ ì–»ìŠµë‹ˆë‹¤. ìŠˆí”„ë¦¼ ì…€ì€ ëŠ¥ë ¥ì¹˜ë¥¼ ë” ì–»ìœ¼ë©° ì²´ë ¥ì´ 10% ì•„ë˜ì¸ ì ì„ ì²˜í˜•í•©ë‹ˆë‹¤.",
  "ì•…ë ¹" : "4ì´ˆë§ˆë‹¤ ê·¸ë¦¼ì ì„¸ê³„ê°€ ê°€ì¥ ê°€ê¹Œìš´ ì  3ëª…ì„ ê³µê²©í•´ ë§ˆì§€ë§‰ ë°œë™ ì´í›„ ì•…ë ¹ì´ ì…íŒ í”¼í•´ëŸ‰ì˜ ì¼ì • ë¹„ìœ¨ë§Œí¼ ë§ˆë²• í”¼í•´ë¥¼ ì…í™ë‹ˆë‹¤. ì²´ë ¥ì´ ê°€ì¥ ë‚®ì€ ì•„êµ° ì•…ë ¹ì´ ì•…ë ¹ê³¼ ê·¸ë¦¼ì ì„¸ê³„ê°€ ì…íŒ í”¼í•´ëŸ‰ì˜ 18%ë§Œí¼ ì²´ë ¥ì„ íšŒë³µí•©ë‹ˆë‹¤.",
  "ì „íˆ¬ì‚¬ê´€í•™êµ" : "ì „íˆ¬ì‚¬ê´€í•™êµ ì±”í”¼ì–¸ì´ ìŠ¤í‚¬ì„ ì—…ê·¸ë ˆì´ë“œí•˜ê³  ì ì¬ë ¥ì„ ì–»ìŠµë‹ˆë‹¤. ì ì¬ë ¥ì€ ì „íˆ¬ì‚¬ê´€í•™êµ ì±”í”¼ì–¸ì˜ ìŠ¤í‚¬ì„ ê°•í™”í•©ë‹ˆë‹¤.",
  "í¬ë£¨" : "í¬ë£¨ ì±”í”¼ì–¸ì´ ë°°ì¹˜í•œ í¬ë£¨ ë©¤ë²„ 1ëª…ë‹¹ ì²´ë ¥ ë° ê³µê²© ì†ë„ë¥¼ 5% ì–»ìŠµë‹ˆë‹¤.3ì„± í¬ë£¨ ì±”í”¼ì–¸ 1ëª…ë‹¹ ì¶”ê°€ íš¨ê³¼ë¥¼ ì–»ìŠµë‹ˆë‹¤.",
  "íƒœì„¸ì˜ ëŒ€ê°€" : "ë¦¬ ì‹ ì„ ë°°ì¹˜í•  ë•Œ ê²°íˆ¬ê°€ íƒœì„¸, ì²˜í˜•ì íƒœì„¸, ì „ìŸê¸°ê³„ íƒœì„¸ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤! ê° íƒœì„¸ëŠ” ê³ ìœ  ìŠ¤í‚¬ì´ ìˆìœ¼ë©°, ë¦¬ ì‹ ì—ê²Œ í•´ë‹¹ íŠ¹ì„±ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.",
  "í”„ë¡œë ˆìŠ¬ëŸ¬": "í”„ë¡œë ˆìŠ¬ëŸ¬ê°€ ì¶”ê°€ ê³µê²©ë ¥ì„ ì–»ìŠµë‹ˆë‹¤. ì²´ë ¥ì´ 50%ì¼ ë•Œ, í”„ë¡œë ˆìŠ¬ëŸ¬ê°€ í•´ë¡œìš´ íš¨ê³¼ë¥¼ ì œê±°í•˜ê³  ì²´ë ¥ì„ íšŒë³µí•œ ë‹¤ìŒ, ì „íˆ¬ì— ë‹¤ì‹œ ë›°ì–´ë“¤ì–´ ë°˜ê²½ 1ì¹¸ ë‚´ ì ì„ 1ì´ˆ ë™ì•ˆ ê¸°ì ˆì‹œí‚µë‹ˆë‹¤.",
  "í•´ì ì„ ì¥" : "íŠ¸ìœ„ìŠ¤í‹°ë“œ í˜ì´íŠ¸ê°€ í¬ë£¨ í•¨ì„ ì„ ì—…ê·¸ë ˆì´ë“œí•´ í”¼í•´ëŸ‰ì˜ 15%ë¥¼ ê³ ì • í”¼í•´ë¡œ ì…íˆë„ë¡ í•˜ë©°, ë¼ìš´ë“œë§ˆë‹¤ ë¬´ì‘ìœ„ ë³´ìƒì„ ì œê³µí•˜ëŠ” í˜„ìƒê¸ˆ ì¹´ë“œë¥¼ ë½‘ìŠµë‹ˆë‹¤. í˜„ìƒê¸ˆ ì¹´ë“œëŠ” í”Œë ˆì´ì–´ ëŒ€ìƒ ì „íˆ¬ë§ˆë‹¤ ë” ì¢‹ì•„ì§‘ë‹ˆë‹¤. ",
  "ê²°íˆ¬ê°€" : "ê²°íˆ¬ê°€ëŠ” ê¸°ë³¸ ê³µê²© ì‹œ ê³µê²© ì†ë„ë¥¼ ì–»ìŠµë‹ˆë‹¤. ìµœëŒ€ 12íšŒê¹Œì§€ ì¤‘ì²©ë©ë‹ˆë‹¤.",
  "ë§ˆë²•ì‚¬" : "ë§ˆë²•ì‚¬ê°€ ì¶”ê°€ ì£¼ë¬¸ë ¥ì„ ì–»ìŠµë‹ˆë‹¤. ì ì´ ë§ˆë²•ì‚¬ì—ê²Œ í”¼í•´ë¥¼ ì…ì€ ë’¤ ì‚¬ë§í•˜ë©´ ìì‹ ì˜ ìµœëŒ€ ì²´ë ¥ì— ë¹„ë¡€í•œ í”¼í•´ë¥¼ ë‹¤ë¥¸ ì ì—ê²Œ ì…í™ë‹ˆë‹¤.",
  "ë´‰ì‡„ì" : "ìœ ë‹›ì´ ë³´í˜¸ë§‰ì´ ì”Œì›Œì¡Œì„ ë•Œ ë‚´êµ¬ë ¥ì„ 5% ì–»ìŠµë‹ˆë‹¤. ì „íˆ¬ë‹¹ 1íšŒ ì²´ë ¥ì´ 50%ì¼ ë•Œ ë´‰ì‡„ìê°€ ê°€ì¥ ê°€ê¹Œìš´ ì•„êµ°ê³¼ ìì‹ ì—ê²Œ ìµœëŒ€ ì²´ë ¥ì˜ ì¼ì • ë¹„ìœ¨ë§Œí¼ í”¼í•´ë¥¼ í¡ìˆ˜í•˜ëŠ” ë³´í˜¸ë§‰ì„ ì”Œì›ë‹ˆë‹¤. ë³´í˜¸ë§‰ì€ ì¤‘ì²©ë©ë‹ˆë‹¤.",
  "ì‹ ë™" : "ì•„êµ°ì´ ë§ˆë‚˜ ì¬ìƒì„ ì–»ìŠµë‹ˆë‹¤. ì‹ ë™ì€ ëŠ¥ë ¥ì¹˜ë¥¼ ë” ì–»ìŠµë‹ˆë‹¤.",
  "ìš”ìƒˆ" : "ì•„êµ°ì´ ë°©ì–´ë ¥ ë° ë§ˆë²• ì €í•­ë ¥ì„ 10 ì–»ìŠµë‹ˆë‹¤. ìš”ìƒˆëŠ” ëŠ¥ë ¥ì¹˜ë¥¼ ë” ì–»ìŠµë‹ˆë‹¤. ì „íˆ¬ ì‹œì‘ í›„ 10ì´ˆ ë™ì•ˆ, ìš”ìƒˆëŠ” ì¶”ê°€ ìˆ˜ì¹˜ë¥¼ 2ë°°ë¡œ ì–»ìŠµë‹ˆë‹¤.",
  "ì´ë‹¨ì•„" : "ì´ë‹¨ì•„ê°€ ëª¨ë“  í”¼í•´ í¡í˜ˆê³¼ ê³µê²©ë ¥ì„ ì–»ìŠµë‹ˆë‹¤. ì²´ë ¥ì´ 50% ì•„ë˜ì¸ ì ì„ ê³µê²©í•  ë•Œ ê³µê²© ì†ë„ë¥¼ 40% ì–»ìŠµë‹ˆë‹¤.",
  "ì¥ë¯¸ ì–´ë¨¸ë‹ˆ" : "ìì´ë¼ì˜ ë³„ ë ˆë²¨ì— ë”°ë¼ ë°°ì¹˜í•  ìˆ˜ ìˆëŠ” ì‹ë¬¼ì„ íšë“í•©ë‹ˆë‹¤. ì „ë°© ê°€ë¡œ 2ì—´ì— ë°°ì¹˜í•œ ì‹ë¬¼ì€ íŠ¼íŠ¼í•œ íœ˜ê°ëŠ” ë¿Œë¦¬ë¡œ ìë¼ë©°, í›„ë°© ê°€ë¡œ 2ì—´ì— ë°°ì¹˜í•œ ì‹ë¬¼ì€ ì¹˜ëª…ì ì¸ ê°€ì‹œë¡œ ìëë‹ˆë‹¤. ì¥ë¯¸ ì–´ë¨¸ë‹ˆì˜ ì‹ë¬¼ì€ ìì´ë¼ ì£¼ë¬¸ë ¥ ë° ê³µê²© ì†ë„ì˜ íš¨ê³¼ë¥¼ ë°›ìŠµë‹ˆë‹¤. ìì´ë¼ê°€ ìŠ¤í‚¬ì„ ì‚¬ìš©í•˜ë©´ ìì´ë¼ì˜ ì‹ë¬¼ì´ ì²´ë ¥ì„ 35% íšŒë³µí•˜ê³  ì „íˆ¬ê°€ ëë‚  ë•Œê¹Œì§€ ê³µê²© ì†ë„ë¥¼ 35% ì–»ìŠµë‹ˆë‹¤. ì‹ë¬¼ì´ ì‚¬ë§í•œ ìƒíƒœë¼ë©´, ëŒ€ì‹  ë¶€í™œì‹œí‚µë‹ˆë‹¤.",
  "ì €ê²©ìˆ˜" : "ì €ê²©ìˆ˜ê°€ í”¼í•´ ì¦í­ì„ ì–»ìŠµë‹ˆë‹¤. ë©€ë¦¬ ë–¨ì–´ì§„ ì ì„ ëŒ€ìƒìœ¼ë¡œ ìˆ˜ì¹˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤.",
  "ì „ìŸê¸°ê³„" : "ì „ìŸê¸°ê³„ê°€ ë‚´êµ¬ë ¥ì„ ì–»ìŠµë‹ˆë‹¤. ì²´ë ¥ì´ 50% ì´ìƒì¼ ê²½ìš° ìˆ˜ì¹˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤. ì „ìŸê¸°ê³„ê°€ ì‚¬ë§í•˜ë©´ ë‹¤ë¥¸ ì „ìŸê¸°ê³„ê°€ ìµœëŒ€ ì²´ë ¥ì˜ 10%ë§Œí¼ ì²´ë ¥ì„ íšŒë³µí•©ë‹ˆë‹¤.",
  "ì±…ëµê°€" : "ì „íˆ¬ ì‹œì‘: ì „ë°© ê°€ë¡œ 2ì—´ì— ìˆëŠ” ì•„êµ°ì´ 15ì´ˆ ë™ì•ˆ ë³´í˜¸ë§‰ì„ ì–»ìŠµë‹ˆë‹¤. í›„ë°© ê°€ë¡œ 2ì—´ì— ìˆëŠ” ì•„êµ°ì´ í”¼í•´ ì¦í­ì„ ì–»ìŠµë‹ˆë‹¤. ì±…ëµê°€ëŠ” ëŠ¥ë ¥ì¹˜ë¥¼ ì„¸ ë°°ë¡œ ì–»ìŠµë‹ˆë‹¤.",
  "ì²˜í˜•ì" : "ì²˜í˜•ìê°€ ì¹˜ëª…íƒ€ í™•ë¥  ë° ì¹˜ëª…íƒ€ í”¼í•´ëŸ‰ì„ ì–»ìŠµë‹ˆë‹¤. ìŠ¤í‚¬ì— ì¹˜ëª…íƒ€ê°€ ì ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
  "í—¤ë¹„ê¸‰" : "ì•„êµ°ì´ ì²´ë ¥ì„ 100 ì–»ìŠµë‹ˆë‹¤. í—¤ë¹„ê¸‰ì€ ì¶”ê°€ ì²´ë ¥ì„ ì–»ê³  ì²´ë ¥ì˜ ì¼ì • ë¹„ìœ¨ë§Œí¼ ê³µê²©ë ¥ì„ ì–»ìŠµë‹ˆë‹¤."
};

const pool=document.getElementById("champion-pool"),
myBoard=document.getElementById("board-my"),
enemyBoard=document.getElementById("board-enemy"),
mySynergy=document.getElementById("mySynergy"),
enemySynergy=document.getElementById("enemySynergy"),
myBar=document.querySelector(".myTeamBar"),
enemyBar=document.querySelector(".enemyTeamBar"),
resultText=document.getElementById("resultText"),
winnerText=document.getElementById("winnerText");

/* âœ… (ì¶”ê°€) ë¦¬ ì‹  íƒœì„¸ ìƒíƒœ */
const leeSinStance = { my: null, enemy: null };
let pendingStanceTeam = null;

function uniq(arr){return [...new Set(arr)];}
function buildCandidatesFromApiName(apiName){
  // tft_ / tftXX_ prefix ì œê±° â†’ íŒŒì¼ëª… í›„ë³´(ëŒ€ì†Œë¬¸ì ëª¨ë‘) + í™•ì¥ì ì¡°í•©
  const raw = (apiName||"").toLowerCase().replace(/^tft\d*_/,'').replace(/^tft_/,'');
  const names = uniq([raw, raw.toLowerCase(), raw.toUpperCase()]);
  const exts  = ['.jpg','.JPG','.png','.PNG','.jpeg','.JPEG'];
  const base  = '/static/images/image/';
  const list=[];
  names.forEach(n=>exts.forEach(ext=>list.push(base+n+ext)));
  return list;
}

function tryNextSrc(img){
  const NO_IMAGE_PATH = "/static/images/image/no_image.jpg";
  try{
    const list = JSON.parse(img.dataset.candidates || "[]");
    const idx = parseInt(img.dataset.idx || "0", 10);
    if (idx + 1 < list.length) {
      img.dataset.idx = idx + 1;
      img.src = list[idx + 1];
    } else {
      img.src = NO_IMAGE_PATH;
    }
  } catch(e) {
    img.src = NO_IMAGE_PATH;
  }
}

async function loadChampionData(){
  const res=await fetch("https://raw.communitydragon.org/latest/cdragon/tft/ko_kr.json");
  const data=await res.json();
  const latest=data.setData.sort((a,b)=>b.number-a.number)[0];
  (latest.traits||[]).forEach(t=>{if(t.apiName&&t.name)TRAIT_NAME_KO[t.apiName]=t.name;});
  const EXCLUDED=["íœ˜ê°ëŠ” ë¿Œë¦¬","ì¹˜ëª…ì ì¸ ê°€ì‹œ","í…ŒìŠ¤íŠ¸ ë¹„ìš©","ê³¨ë ˜","í˜‘ê³¡ ë°”ìœ„ ê²Œ","í›ˆë ¨ ë´‡","ì–´ìŠ¤ë¦„ëŠ‘ëŒ€","ê¿€ì¼ í‹°ëª¨","íŒí…Œì˜¨","í‹°ëª¨","ì†Œë¼ì¹´ì˜ ìˆ˜í˜¸ì","ê³µí—ˆ ìƒë¬¼","ì¡°ì´","ì†Œë¼ì¹´","ì¥ë¡œ ë“œë˜ê³¤","ì§„ë¦¬ìš© ì•¼ìŠ¤ì˜¤"];
  CHAMPIONS=latest.champions.filter(c=>!EXCLUDED.includes(c.name)).map(c=>{
    return{
      id:c.apiName,
      name:c.name,
      cost:c.cost,
      traitsIds:[...(c.traits||[])],
      traitsKo:(c.traits||[]).map(id=>TRAIT_NAME_KO[id]||id),
      imgCandidates: buildCandidatesFromApiName(c.apiName)
    };
  });
  renderChampionPool();makeHexBoard(myBoard);makeHexBoard(enemyBoard);addDragEvents();updateAllSynergy();
}

function renderChampionPool(){
  pool.innerHTML="";
  [1,2,3,4,5].forEach(cost=>{
    const group=CHAMPIONS.filter(c=>c.cost===cost);
    if(group.length){
      const div=document.createElement("div");
      div.className="cost-group";
      div.innerHTML=`<h3>${"â­".repeat(cost)} ${cost}ì½”ìŠ¤íŠ¸</h3>`;
      const grid=document.createElement("div");
      grid.className="group-grid";
      group.forEach(ch=>{
        const el=document.createElement("div");
        el.className=`champion cost-${ch.cost}`;el.draggable=true;el.dataset.id=ch.id;
        el.title=`${ch.name} (${ch.cost}ì½”) ${ch.traitsKo.join(", ")}`;

        const candidates = ch.imgCandidates;
        el.innerHTML=`<img src="${candidates[0]}" alt="${ch.name}"
          data-candidates='${JSON.stringify(candidates)}' data-idx="0"
          onerror="tryNextSrc(this)">`;
        grid.appendChild(el);
      });
      div.appendChild(grid);pool.appendChild(div);
    }
  });
}

let __slotUid=0;
function makeHexBoard(board){
  board.innerHTML="";
  for(let r=0;r<4;r++){
    const row=document.createElement("div");
    row.className="board-row";
    for(let c=0;c<7;c++){
      const slot=document.createElement("div");
      slot.className="slot";
      slot.dataset.slotId = (++__slotUid).toString();

      slot.addEventListener("dragover",e=>{e.preventDefault();slot.classList.add("over");});
      slot.addEventListener("dragleave",()=>slot.classList.remove("over"));

    slot.addEventListener("drop", e=>{
  e.preventDefault(); slot.classList.remove("over");
  const fromSlotId = e.dataTransfer.getData("fromSlot");
  const champId    = e.dataTransfer.getData("text/plain");
  const isSpecial  = e.dataTransfer.getData("special") === "1"; // âœ… ìŠ¤í˜ì…œ ì´ë™ í”Œë˜ê·¸

  if (fromSlotId && fromSlotId === slot.dataset.slotId) return;

  // 1) ìŠ¤í˜ì…œ ì´ë¯¸ì§€ ì´ë™ (ê±°ëŒ€ ë©”í¬ ë¡œë´‡ / íœ˜ê°ëŠ” ë¿Œë¦¬)
  if (isSpecial && fromSlotId) {
    const origin = document.querySelector('.slot[data-slot-id="'+fromSlotId+'"]');
    const imgEl  = origin?.querySelector('img');
    if (imgEl) {
      // íƒ€ê²Ÿ ë¹„ìš°ê³  ë…¸ë“œ ì´ë™
      slot.innerHTML = "";
      slot.appendChild(imgEl); // DOM ì´ë™ (ë³µì‚¬ ì•„ë‹˜)
      updateAllSynergy();
    }
    return;
  }

  // 2) ì¼ë°˜ ì±”í”¼ì–¸ ë°°ì¹˜
  const existingImg = slot.querySelector("img");
  if (existingImg) existingImg.remove();
  const champ = CHAMPIONS.find(x=>x.id===champId);
  if (champ) {
    const candidates = champ.imgCandidates;
    const tooltip = `${champ.name} (${champ.cost}ì½”) ${champ.traitsKo.join(", ")}`;

    slot.innerHTML = `
      <img src="${candidates[0]}"
          data-id="${champ.id}"
          alt="${champ.name}"
          title="${tooltip}"
          draggable="true"
          data-candidates='${JSON.stringify(candidates)}'
          data-idx="0"
          ondragstart="event.dataTransfer.setData('text/plain', this.dataset.id);
                        event.dataTransfer.setData('fromSlot', this.closest('.slot').dataset.slotId);"
          onerror="tryNextSrc(this)">
    `;

    if (fromSlotId) {
      const origin=document.querySelector('.slot[data-slot-id="'+fromSlotId+'"]');
      if(origin && origin!==slot){ origin.innerHTML=""; }
    }

    // ë¦¬ ì‹ ì´ë©´ íƒœì„¸ ì„ íƒ ëª¨ë‹¬
    if (isLeeSin(champ)) {
      const teamKey = (board.id === 'board-my') ? 'my' : 'enemy';
      openStanceModal(teamKey);
    }

    updateAllSynergy();
  }
});

      slot.addEventListener("contextmenu",e=>{e.preventDefault();slot.innerHTML="";updateAllSynergy();});
      row.appendChild(slot);
    }
    board.appendChild(row);
  }
}

function addDragEvents(){
  document.querySelectorAll(".champion").forEach(el=>
    el.addEventListener("dragstart",e=>{
      e.dataTransfer.setData("text/plain",el.dataset.id);
    })
  );
}

function readTeam(board){return CHAMPIONS.filter(ch=>[...board.querySelectorAll("img")].map(i=>i.dataset.id).includes(ch.id));}
function countTraitsKo(team){const t={};team.forEach(ch=>ch.traitsIds.forEach(id=>{const ko=TRAIT_NAME_KO[id]||id;t[ko]=(t[ko]||0)+1;}));return t;}

/* âœ… (ì¶”ê°€) ë¦¬ ì‹  íŒë³„ ë° íƒœì„¸ ì‹œë„ˆì§€ í•©ì‚° */
function isLeeSin(ch){
  // apiName ë‚´ 'leesin' í¬í•¨ ì—¬ë¶€ë¡œ íŒë³„ (ëŒ€/ì†Œë¬¸ì ë¬´ê´€)
  return (ch?.id||'').toLowerCase().includes('leesin');
}
function teamHasLeeSin(teamArr){
  return teamArr.some(isLeeSin);
}
function applyLeeSinStance(traits, teamKey, teamArr){
  if (!teamHasLeeSin(teamArr)) return traits;
  const stance = leeSinStance[teamKey];
  if (!stance) return traits;
  traits[stance] = (traits[stance] || 0) + 1;
  return traits;
}

function getSynergyClass(name, count) {
  const single = ["ë ˆìŠ¬ë§ ì±”í”¼ì–¸", "íƒœì„¸ì˜ ëŒ€ê°€", "ì¥ë¯¸ ì–´ë¨¸ë‹ˆ", "í•´ì ì„ ì¥", "ê´´ë¬¼ íŠ¸ë ˆì´ë„ˆ"];
  if (single.includes(name)) return count >= 1 ? "bronze" : "normal";

  const common245 = ["ì €ê²©ìˆ˜", "í¬ë£¨", "ì±…ëµê°€", "ì²˜í˜•ì", "ì‹ ë™"];
  if (common245.includes(name)) {
    if (count >= 5) return "prism";
    if (count >= 4) return "gold";
    if (count >= 3) return "silver";
    if (count >= 2) return "bronze";
    return "normal";
  }

  if (name === "ìˆ˜ì • ê°¬ë¹—") {
    if (count >= 10) return "prism";
    if (count >= 7) return "gold";
    if (count >= 5) return "silver";
    if (count >= 3) return "bronze";
    return "normal";
  }

  if (["ì „íˆ¬ì‚¬ê´€í•™êµ", "ê±°ëŒ€ ë©”í¬"].includes(name)) {
    if (count >= 7) return "gold";
    if (count >= 5) return "silver";
    if (count >= 3) return "bronze";
    return "normal";
  }

  if (["ì•…ë ¹", "í—¤ë¹„ê¸‰", "ìš”ìƒˆ", "ë§ˆë²•ì‚¬", "í”„ë¡œë ˆìŠ¬ëŸ¬"].includes(name)) {
    if (count >= 6) return "gold";
    if (count >= 4) return "silver";
    if (count >= 2) return "bronze";
    return "normal";
  }

  if (name === "ì†Œìš¸íŒŒì´í„°") {
    if (count >= 8) return "prism";
    if (count >= 6) return "gold";
    if (count >= 4) return "silver";
    if (count >= 2) return "bronze";
    return "normal";
  }

  if (name === "ë³„ìˆ˜í˜¸ì") {
    if (count >= 8) return "prism";
    if (count >= 6) return "gold";
    if (count >= 4) return "silver";
    if (count >= 2) return "bronze";
    return "normal";
  }

  if (name === "ë©˜í† ") {
    if (count === 4) return "gold";
    if (count === 1) return "bronze";
    return "normal";
  }

  if (name === "ìŠˆí”„ë¦¼ì…€") {
    if (count >= 4) return "gold";
    if (count >= 3) return "silver";
    if (count >= 2) return "bronze";
    return "normal";
  }

  if (count >= 10) return "prism";
  if (count >= 6) return "gold";
  if (count >= 4) return "silver";
  if (count >= 2) return "bronze";
  return "normal";
}

/* âœ… renderSynergy ìˆ˜ì • â€” íŠ¹ì • 4ê°œë§Œ 1ê°œì¼ ë•Œ í™œì„±í™” (ì›ë³¸ ê·¸ëŒ€ë¡œ) */
function renderSynergy(container, traits) {
  container.innerHTML = "";
  const keys = Object.keys(traits);
  if (!keys.length) {
    container.innerHTML =
      '<div class="synergy-item normal"><span>ì—†ìŒ</span><span>â€”</span></div>';
    return;
  }

  const blueOnly = [
    "ë ˆìŠ¬ë§ ì±”í”¼ì–¸",
    "íƒœì„¸ì˜ ëŒ€ê°€",
    "ì¥ë¯¸ ì–´ë¨¸ë‹ˆ",
    "í•´ì ì„ ì¥",
  ];

  // ì •ë ¬ ìˆœì„œ ì •ì˜
  const order = { unique: 5, prism: 4, gold: 3, silver: 2, bronze: 1, normal: 0 };

  const sorted = keys.sort((a, b) => {
    const aCount = traits[a];
    const bCount = traits[b];
    const aGrade = getSynergyClass(a, aCount);
    const bGrade = getSynergyClass(b, bCount);

    // í•˜ëŠ˜ìƒ‰ íŠ¹ì„± ì—¬ë¶€
    const aIsBlue = blueOnly.includes(a) && aCount === 1;
    const bIsBlue = blueOnly.includes(b) && bCount === 1;

    // 1ï¸âƒ£ í•˜ëŠ˜ìƒ‰ì´ ìµœìš°ì„ 
    if (aIsBlue && !bIsBlue) return -1;
    if (!aIsBlue && bIsBlue) return 1;

    // 2ï¸âƒ£ ìƒ‰ìƒ ìˆœìœ„ ì •ë ¬ (prism > gold > silver > bronze > normal)
    const diff = (order[bGrade] || 0) - (order[aGrade] || 0);
    if (diff !== 0) return diff;

    // 3ï¸âƒ£ ê°œìˆ˜ ë§ì€ ìˆœ (ë³´ì¡° ê¸°ì¤€)
    return bCount - aCount;
  });

  sorted.forEach((n) => {
    const v = traits[n];
    const grade = getSynergyClass(n, v);
    const el = document.createElement("div");
    el.className = `synergy-item ${grade}`;

    // í•˜ëŠ˜ìƒ‰ í‘œì‹œ
    if (blueOnly.includes(n) && v === 1) {
      el.className = "synergy-item unique";
    }

    const desc = TRAIT_DESCRIPTIONS[n] || "ì„¤ëª… ì¤€ë¹„ì¤‘";
    el.title = `[${n}] ${desc}\nê°œìˆ˜: ${v}ê°œ / ë“±ê¸‰: ${grade}`;

    el.innerHTML = `<span>${n}</span><span>${v}ê°œ</span>`;
    container.appendChild(el);
  });
}

/* âœ… (ì¶”ê°€) ë¦¬ ì‹  íƒœì„¸ë¥¼ ë°˜ì˜í•˜ë„ë¡ updateAllSynergy ë³´ì¡° */
// âœ… 1) ê±°ëŒ€ ë©”í¬ ë¡œë´‡ ìƒì„± ì²´í¬ (ì–‘ìª½ íŒ€ ê³µí†µ)
// âœ… ê±°ëŒ€ ë©”í¬ / ìì´ë¼ íŠ¹ìˆ˜ ìœ ë‹› ìƒì„± + ë¹„í™œì„±í™” ì‹œ ìë™ ì‚­ì œ
function checkSpecialUnits(board, teamArr, traits, teamName) {
  const existingImgs = [...board.querySelectorAll(".slot img")];
  const hasRobot = existingImgs.some(img => img.alt === "ê±°ëŒ€ ë©”í¬ ë¡œë´‡");
  const hasRoot  = existingImgs.some(img => img.alt === "íœ˜ê°ëŠ” ë¿Œë¦¬");

  // ----- ê±°ëŒ€ ë©”í¬ -----
  const mechaCount = traits["ê±°ëŒ€ ë©”í¬"] || 0;
  const mechaGrade = getSynergyClass("ê±°ëŒ€ ë©”í¬", mechaCount);
  const shouldHaveRobot = ["bronze", "silver", "gold", "prism"].includes(mechaGrade);

  if (shouldHaveRobot && !hasRobot) {
    console.log(`âœ… [${teamName}] ê±°ëŒ€ ë©”í¬ ë¡œë´‡ ìƒì„±`);
    addSpecialUnit(board, "ê±°ëŒ€ ë©”í¬ ë¡œë´‡", "mecha_robot.jpg");
  } else if (!shouldHaveRobot && hasRobot) {
    console.log(`âŒ [${teamName}] ê±°ëŒ€ ë©”í¬ ì‹œë„ˆì§€ ë¹„í™œì„±í™” â†’ ë¡œë´‡ ì œê±°`);
    removeSpecialUnit(board, "ê±°ëŒ€ ë©”í¬ ë¡œë´‡");
  }

  // ----- ìì´ë¼ -----
  const hasZyra = teamArr.some(ch => ch.name.includes("ìì´ë¼"));
  if (hasZyra && !hasRoot) {
    console.log(`ğŸŒ¿ [${teamName}] ìì´ë¼ í¬í•¨ â†’ íœ˜ê°ëŠ” ë¿Œë¦¬ ìƒì„±`);
    addSpecialUnit(board, "íœ˜ê°ëŠ” ë¿Œë¦¬", "root.jpg");
  } else if (!hasZyra && hasRoot) {
    console.log(`ğŸŒ¿ [${teamName}] ìì´ë¼ ì—†ìŒ â†’ íœ˜ê°ëŠ” ë¿Œë¦¬ ì œê±°`);
    removeSpecialUnit(board, "íœ˜ê°ëŠ” ë¿Œë¦¬");
  }
}

// âœ… íŠ¹ìˆ˜ ìœ ë‹› ì œê±° í•¨ìˆ˜ ì¶”ê°€
function removeSpecialUnit(board, name) {
  [...board.querySelectorAll(".slot img")].forEach(img => {
    if (img.alt === name) {
      const slot = img.closest(".slot");
      if (slot) slot.innerHTML = "";
    }
  });
}


function updateAllSynergy() {
  const myTeamArr = readTeam(myBoard);
  const enTeamArr = readTeam(enemyBoard);
  let myT = countTraitsKo(myTeamArr);
  let enT = countTraitsKo(enTeamArr);

  // ë¦¬ ì‹  íƒœì„¸ ì ìš©
  myT = applyLeeSinStance(myT, 'my', myTeamArr);
  enT = applyLeeSinStance(enT, 'enemy', enTeamArr);

  // âœ… ë‚´ íŒ€ / ìƒëŒ€ íŒ€ ëª¨ë‘ íŠ¹ìˆ˜ ìœ ë‹› ìƒì„± ì²´í¬
  checkSpecialUnits(myBoard, myTeamArr, myT, "ë‚´ íŒ€");
  checkSpecialUnits(enemyBoard, enTeamArr, enT, "ìƒëŒ€ íŒ€");

  // âœ… ì‹œë„ˆì§€ í‘œì‹œ ì—…ë°ì´íŠ¸
  renderSynergy(mySynergy, myT);
  renderSynergy(enemySynergy, enT);
}



function addSpecialUnit(board, name, imgPath){
  // ì´ë¯¸ ìˆìœ¼ë©´ ì¤‘ë³µ ìƒì„± X
  if ([...board.querySelectorAll(".slot img")].some(i => i.alt === name)) return;

  const emptySlot = [...board.querySelectorAll(".slot")].find(s => !s.querySelector("img"));
  if (!emptySlot) return;

  emptySlot.innerHTML = `
    <img src="/static/images/image/${imgPath}"
         alt="${name}"
         draggable="true"
         data-special="1"
         ondragstart="event.dataTransfer.setData('special','1');
                      event.dataTransfer.setData('fromSlot', this.closest('.slot').dataset.slotId);">
  `;
}


function calcScore(team, traits) {
  if (!team.length) return 0;

  // í‰ê·  ì½”ìŠ¤íŠ¸ ê³„ì‚°
  const avgCost = team.reduce((sum, c) => sum + (c.cost || 0), 0) / team.length;
  let base = team.reduce((sum, c) => sum + (c.cost || 0), 0);

  // 1ï¸âƒ£ ì½”ìŠ¤íŠ¸ íš¨ìœ¨ ë³´ì • (5ì½” ëª°ë¹µ ë°©ì§€)
  const costPenalty = 1 - Math.min(0.15, (avgCost - 2.8) * 0.04);
  base *= costPenalty;

  // 2ï¸âƒ£ ì‹œë„ˆì§€ ë“±ê¸‰ë³„ ê°€ì¤‘ì¹˜
  let synergyBonus = 0;
  for (const [name, count] of Object.entries(traits)) {
    const grade = getSynergyClass(name, count);

    let mult = 1.0;
    if (grade === "prism") mult = 1.20;
    else if (grade === "gold") mult = 1.10;
    else if (grade === "silver") mult = 1.05;
    else if (grade === "bronze") mult = 1.02;

    // íŠ¹ìˆ˜ 5ì½” ì‹œë„ˆì§€ ê°•í™” (ê´´ë¬¼ íŠ¸ë ˆì´ë„ˆ ì œì™¸)
    const special = ["íƒœì„¸ì˜ ëŒ€ê°€", "ë ˆìŠ¬ë§ ì±”í”¼ì–¸", "ì¥ë¯¸ ì–´ë¨¸ë‹ˆ", "í•´ì ì„ ì¥"];
    if (special.includes(name)) mult *= 1.5;

    synergyBonus += Math.pow(count, 0.9) * mult;
  }

  // ì‹œë„ˆì§€ ê°œìˆ˜ ë§ì„ìˆ˜ë¡ íš¨ìœ¨ ë‘”í™”
  const totalSynergy = Object.values(traits).reduce((a, b) => a + b, 0);
  const synergyEfficiency = Math.log2(1 + totalSynergy / 4);

  // 3ï¸âƒ£ íƒ±ì»¤ / ë”œëŸ¬ ë°¸ëŸ°ìŠ¤ ê°ì  (ê°•í™” ë²„ì „)
  const TANK_TRAITS = ["ìš”ìƒˆ", "í”„ë¡œë ˆìŠ¬ëŸ¬", "ì•…ë ¹", "ì „íˆ¬ì‚¬ê´€í•™êµ", "í—¤ë¹„ê¸‰"];
  const DAMAGE_TRAITS = ["ë§ˆë²•ì‚¬", "ì €ê²©ìˆ˜", "ì†Œìš¸íŒŒì´í„°", "ì²˜í˜•ì", "ì‹ ë™", "ì±…ëµê°€", "ë³„ìˆ˜í˜¸ì"];

  const tankCount = Object.entries(traits).filter(([n, v]) => TANK_TRAITS.includes(n) && v > 0).length;
  const dmgCount = Object.entries(traits).filter(([n, v]) => DAMAGE_TRAITS.includes(n) && v > 0).length;

  let balancePenalty = 1.0;

  if (tankCount === 0 && dmgCount === 0) {
    balancePenalty -= 0.3; // ê·¹ë‹¨ì  ì¡°í•© (íƒ±ì»¤X ë”œëŸ¬X)
  } 
  else if (tankCount === 0) {
    balancePenalty -= 0.2; // íƒ±ì»¤ ì „ë¬´
  } 
  else if (dmgCount === 0) {
    balancePenalty -= 0.2; // ë”œëŸ¬ ì „ë¬´
  } 
  else if (tankCount <= 1 && dmgCount <= 1) {
    balancePenalty -= 0.08; // ë‘˜ ë‹¤ ë„ˆë¬´ ì ìŒ
  } 
  else if (tankCount <= 1 || dmgCount <= 1) {
    balancePenalty -= 0.05; // í•œìª½ë§Œ ë¶€ì¡±
  }

  // 4ï¸âƒ£ í™œì„±í™”ëœ ì‹œë„ˆì§€ ê°œìˆ˜ ê¸°ë°˜ ê°€ì‚°ì 
  const activeSynergies = Object.keys(traits).filter(k => traits[k] >= 2).length;
  const synergyBonusFactor = 1 + Math.min(0.15, activeSynergies * 0.02); 
  // (ìµœëŒ€ +15%, 2ê°œë‹¹ +4%)

  // 5ï¸âƒ£ ìµœì¢… ì ìˆ˜ ê³„ì‚°
  const score = (base + synergyBonus * synergyEfficiency * 2) * balancePenalty * synergyBonusFactor;
  return score;
}

function showVisualResult(rate,myS,enS){
  const e=100-rate;
  myBar.style.width=`${rate}%`;enemyBar.style.width=`${e}%`;
  resultText.innerHTML=`ë‚´íŒ€ ${myS.toFixed(1)} (${rate}%) | ìƒëŒ€ ${enS.toFixed(1)} (${e}%)`;
  if(rate>50){winnerText.textContent="ğŸ’ª ë‚´ íŒ€ ìš°ì„¸!";winnerText.className="winner-text winner-blue";}
  else if(rate<50){winnerText.textContent="âš”ï¸ ìƒëŒ€ íŒ€ ìš°ì„¸!";winnerText.className="winner-text winner-red";}
  else{winnerText.textContent="âš–ï¸ ê· í˜• ì¡í˜!";winnerText.className="winner-text";}
}

document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("resetMyTeam").addEventListener("click",()=>{
    myBoard.querySelectorAll(".slot").forEach(s=>s.innerHTML="");
    updateAllSynergy();
    myBar.style.width="50%";enemyBar.style.width="50%";
    winnerText.textContent="";
    resultText.textContent="íŒ€ì„ ë°°ì¹˜í•˜ë©´ ì‹œë„ˆì§€ê°€ ì˜¤ë¥¸ìª½ì— í‘œì‹œë©ë‹ˆë‹¤.";
  });
  document.getElementById("resetEnemyTeam").addEventListener("click",()=>{
    enemyBoard.querySelectorAll(".slot").forEach(s=>s.innerHTML="");
    updateAllSynergy();
    myBar.style.width="50%";enemyBar.style.width="50%";
    winnerText.textContent="";
    resultText.textContent="íŒ€ì„ ë°°ì¹˜í•˜ë©´ ì‹œë„ˆì§€ê°€ ì˜¤ë¥¸ìª½ì— í‘œì‹œë©ë‹ˆë‹¤.";
  });

  /* âœ… ëª¨ë‹¬ ë²„íŠ¼ ì´ë²¤íŠ¸ (ì¶”ê°€) */
  const backdrop = document.getElementById('stanceBackdrop');
  backdrop.addEventListener('click', (e)=>{
    if(e.target === backdrop) closeStanceModal();
  });
  document.getElementById('stanceCancel').addEventListener('click', closeStanceModal);
  document.querySelectorAll('.stance-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(!pendingStanceTeam) return;
      const stance = btn.dataset.stance; // "ì²˜í˜•ì" | "ì „ìŸê¸°ê³„" | "ê²°íˆ¬ê°€"
      leeSinStance[pendingStanceTeam] = stance;
      closeStanceModal();
      updateAllSynergy();
    });
  });
});

document.getElementById("analyze").addEventListener("click",()=>{
  const my=readTeam(myBoard),en=readTeam(enemyBoard);
  if(!my.length&&!en.length)return alert("íŒ€ì„ ë°°ì¹˜í•´ ì£¼ì„¸ìš”!");
  // ë¦¬ ì‹  íƒœì„¸ ì‹œë„ˆì§€ë¥¼ ì ìˆ˜ ê³„ì‚°ì—ë„ ë°˜ì˜í•˜ë ¤ë©´ traits ë§Œë“¤ê¸° ì „ì— updateAllSynergy()ì—ì„œ ì´ë¯¸ ë°˜ì˜ë¨
  // ë‹¤ì‹œ ê³„ì‚°ìš©ìœ¼ë¡œ traits êµ¬ì„±
  let myT=countTraitsKo(my),enT=countTraitsKo(en);
  myT = applyLeeSinStance(myT, 'my', my);
  enT = applyLeeSinStance(enT, 'enemy', en);

  const myS=calcScore(my,myT),enS=calcScore(en,enT);
  const tot=myS+enS||1,rate=Math.round((myS/tot)*100);
  showVisualResult(rate,myS,enS);updateAllSynergy();
});
loadChampionData();

/* âœ… (ì¶”ê°€) ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸° */
function openStanceModal(teamKey){
  pendingStanceTeam = teamKey; // 'my' | 'enemy'
  const txt = (teamKey==='my') ? 'ë‚´ íŒ€' : 'ìƒëŒ€ íŒ€';
  document.getElementById('stanceTeamText').textContent = `ì ìš© ëŒ€ìƒ: ${txt}`;
  const el = document.getElementById('stanceBackdrop');
  el.style.display='flex';
  el.setAttribute('aria-hidden','false');
}
function closeStanceModal(){
  const el = document.getElementById('stanceBackdrop');
  el.style.display='none';
  el.setAttribute('aria-hidden','true');
  pendingStanceTeam = null;
}
</script>
</body>
</html>
